# Camera Cloud 管理后台使用指南

## 🎉 系统已经成功启动！

您的Camera Cloud管理系统已经完整配置并运行中。

## 📱 访问管理后台

### 1. 登入页面
访问地址：**http://localhost:8080/login**

**默认管理员账号**：
- 账号：`admin`
- 密码：`admin123`
- 权限：MAIN_ADMIN（完整权限）

### 2. 管理界面

登入成功后，您会看到左侧有侧边栏，包含以下菜单：

#### 📊 控制台
- 地址：http://localhost:8080/admin/dashboard
- 显示系统概览、统计数据
- 快速访问各个管理功能

#### 🌐 平台管理
- 地址：http://localhost:8080/admin/platforms
- **功能**：
  - 查看所有串流平台（YouTube, Twitch, Facebook, Instagram）
  - 新增平台
  - 测试平台连通性
  - 编辑平台设定

#### 📹 相机管理
- 地址：http://localhost:8080/admin/cameras
- **功能**：
  - 查看所有相机列表
  - 搜索和筛选相机（按平台、状态）
  - 指派相机到不同平台
  - 启用/停用相机串流（Redirect开关）
  - 批量匯入相机（Excel/CSV）
  - 直接查看相机串流

#### ⚙️ 设定
- 地址：http://localhost:8080/admin/settings
- **功能**：
  - 查看帐号资讯
  - 系统设定
  - 应用资讯

#### 💚 系统状态
- 地址：http://localhost:8080/actuator/health
- 实时查看系统健康状态

## 🔧 主要功能说明

### 平台管理

**新增平台**：
1. 点击"新增平台"按钮
2. 输入平台代码（小写英文、数字、底线、连字号）
3. 输入平台名称
4. 系统自动创建

**测试平台**：
- 点击"测试"按钮检查平台状态
- 显示连通测试结果

### 相机管理

**查看相机**：
- 表格显示所有相机资讯
- 包含：相机ID、型号、目标平台、状态、Redirect开关

**搜索功能**：
- 在搜索框输入相机ID或型号进行搜索
- 使用下拉选单按平台或状态筛选

**指派平台**：
1. 点击相机行的"指派平台"按钮
2. 输入平台代码
3. 系统更新相机的目标平台

**Redirect开关**：
- 使用切换开关启用/停用相机串流
- 停用后，该相机的 `/view` 端点将拒绝访问

**批量匯入**：
1. 点击"批量匯入"按钮
2. 上传Excel (.xlsx) 或CSV檔案
3. 檔案格式：
   ```
   camera_id, model, platform_code, status
   CAM_001, Camera A, youtube, active
   CAM_002, Camera B, twitch, active
   ```
4. 系统后台处理并显示结果

**查看串流**：
- 点击"查看"按钮在新窗口打开相机串流页面
- 地址格式：`http://localhost:8080/view?camera_id=CAM_001`

## 🔐 安全功能

### 速率限制
- 每个相机ID在60秒内只能访问一次
- 超过限制返回HTTP 429错误
- 自动记录访问日志

### Redirect控制
- 管理员可随时停用相机串流
- 停用后返回HTTP 403 Forbidden
- 操作记录在审计日志中

## 📡 API端点

所有API端点都需要认证（使用Basic Auth或登入后的Session）。

### 平台管理API
```bash
# 取得所有平台
curl -u admin:admin123 http://localhost:8080/api/v1/admin/platforms

# 新增平台
curl -u admin:admin123 -X POST http://localhost:8080/api/v1/admin/platforms \
  -H "Content-Type: application/json" \
  -d '{"code":"tiktok","name":"TikTok"}'

# 测试平台
curl -u admin:admin123 -X POST http://localhost:8080/api/v1/admin/platforms/youtube/test
```

### 相机管理API
```bash
# 取得所有相机
curl -u admin:admin123 http://localhost:8080/api/v1/admin/cameras

# 指派相机到平台
curl -u admin:admin123 -X POST http://localhost:8080/api/v1/admin/cameras/CAM_001/assign-platform \
  -H "Content-Type: application/json" \
  -d '{"platformCode":"youtube"}'

# 启用/停用Redirect
curl -u admin:admin123 -X PATCH http://localhost:8080/api/v1/admin/cameras/CAM_001/redirect \
  -H "Content-Type: application/json" \
  -d '{"enabled":false}'
```

### 公开端点
```bash
# 相机串流查看（无需认证，但有速率限制）
curl http://localhost:8080/view?camera_id=CAM_001

# 系统健康检查
curl http://localhost:8080/actuator/health
```

## 🎨 界面特色

### 左侧侧边栏
- 固定在左侧，方便快速导航
- 清晰的图标和文字标签
- 当前页面高亮显示
- 响应式设计，适配各种屏幕

### 现代化UI
- 渐层紫蓝色主题
- 卡片式布局
- 流畅的动画效果
- 清晰的状态标识（徽章、开关）

### 实时更新
- 数据自动载入
- 操作立即反映
- 友善的错误提示

## 🚀 快速测试

### 测试相机串流
```bash
# 第一次访问 - 成功
curl http://localhost:8080/view?camera_id=CAM_001
# 返回：200 OK (HTML页面)

# 立即再次访问 - 被速率限制
curl http://localhost:8080/view?camera_id=CAM_001
# 返回：429 Too Many Requests

# 等待60秒后再次访问 - 成功
sleep 60
curl http://localhost:8080/view?camera_id=CAM_001
# 返回：200 OK
```

### 测试管理功能
1. 打开浏览器访问：http://localhost:8080/login
2. 输入：admin / admin123
3. 点击"登入"
4. 浏览左侧侧边栏的各个功能
5. 尝试查看平台列表
6. 尝试查看相机列表
7. 测试搜索和筛选功能
8. 尝试切换Redirect开关

## 📊 系统监控

### 健康检查
```bash
curl http://localhost:8080/actuator/health
```

### Prometheus指标
```bash
curl http://localhost:8080/actuator/prometheus
```

### Redis监控
```bash
# 连接Redis CLI
docker exec -it camera-cloud-redis redis-cli

# 查看速率限制key
KEYS rate:view:*

# 查看特定key的TTL
TTL rate:view:CAM_001
```

### 数据库查询
```bash
# 连接PostgreSQL
docker exec -it camera-cloud-postgres psql -U camera_user -d camera_cloud

# 查询相机
SELECT * FROM cameras;

# 查询平台
SELECT * FROM platforms;

# 查询审计日志
SELECT * FROM audit_logs ORDER BY created_at DESC LIMIT 10;
```

## 🛠️ 故障排除

### 无法登入
- 确认账号密码正确：admin / admin123
- 检查应用是否正常运行：`curl http://localhost:8080/actuator/health`

### API返回错误
- 检查是否提供认证信息
- 查看应用日志：`docker logs camera-cloud-app` 或检查控制台输出

### 页面显示异常
- 刷新页面（Ctrl+F5 / Cmd+Shift+R）
- 清除浏览器缓存
- 检查浏览器控制台是否有JavaScript错误

### 数据库连接失败
- 确认PostgreSQL正在运行：`docker ps | grep postgres`
- 检查连接字符串和凭证

### Redis连接失败
- 确认Redis正在运行：`docker ps | grep redis`
- 检查Redis是否在6379端口

## 📝 注意事项

1. **安全性**：
   - 生产环境请修改默认密码
   - 使用HTTPS
   - 配置防火墙规则

2. **性能**：
   - 定期清理审计日志
   - 监控Redis内存使用
   - 设定数据库连接池大小

3. **备份**：
   - 定期备份PostgreSQL数据库
   - 备份配置文件

4. **扩展**：
   - 可以添加更多平台
   - 可以自定义速率限制规则
   - 可以扩展审计功能

## 🎯 下一步

1. ✅ 系统已成功运行
2. ✅ 管理后台界面已创建
3. ✅ 左侧侧边栏导航已实现
4. ✅ 平台管理功能完成
5. ✅ 相机管理功能完成
6. ✅ 设定页面已创建

**现在可以开始使用了！**

打开浏览器访问：**http://localhost:8080/login**

享受您的Camera Cloud管理系统！🎉



